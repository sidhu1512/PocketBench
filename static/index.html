<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PocketBench</title>
    
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/terminal.css">
    <link rel="stylesheet" href="css/settings.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
</head>
<body>

    <div id="toast-container"></div>

    <div id="terminal-overlay" class="overlay" onclick="toggleTerminal()"></div>
    <div id="terminal-modal" class="terminal-modal">
        <div class="term-header">
            <h3>Terminal Output</h3>
            <button class="close-term" onclick="toggleTerminal()">×</button>
        </div>
        <pre id="logs">Waiting for logs...</pre>
    </div>

    <div id="settings-overlay" class="overlay" onclick="toggleSettings()"></div>
    <div id="settings-modal" class="terminal-modal" style="height:auto; min-height:auto; max-width:400px;">
        <div class="term-header">
            <h3>Settings</h3>
            <button class="close-term" onclick="toggleSettings()">×</button>
        </div>
        <div style="padding: 20px;">
            
            <div class="settings-group">
                <div class="settings-row">
                    <span class="label" style="margin:0">Hardware Acceleration</span>
                    <select id="setting-device" class="settings-select">
                        <option value="auto">Auto Detect</option>
                        <option value="cuda">Nvidia CUDA (Windows/Linux)</option>
                        <option value="mps">Apple Metal (Mac M1/M2/M3)</option>
                        <option value="cpu">CPU Only (Slow)</option>
                    </select>
                </div>
                <div class="settings-info">
                    Use <b>CUDA</b> for Nvidia RTX cards.<br>
                    Use <b>Apple Metal</b> for Macbooks.<br>
                    Use <b>CPU</b> if benchmarks crash.
                </div>
            </div>

            <div class="settings-group">
                <div class="settings-row">
                    <span class="label" style="margin:0">Batch Size</span>
                    <select id="setting-batch" class="settings-select">
                        <option value="1">1 (Safe)</option>
                        <option value="2">2</option>
                        <option value="4">4</option>
                        <option value="8">8 (Fast GPU)</option>
                        <option value="16">16 (High End)</option>
                    </select>
                </div>
                <div class="settings-info">
                    Higher values are faster but require more VRAM. Reduce this if you see "Out of Memory" errors.
                </div>
            </div>
            
            <div class="settings-group">
                <div class="settings-row">
                    <span class="label" style="margin:0">Log Verbosity</span>
                    <select id="setting-verbosity" class="settings-select">
                        <option value="INFO">Info</option>
                        <option value="WARNING">Warning</option>
                        <option value="ERROR">Error</option>
                        <option value="DEBUG">Debug</option>
                    </select>
                </div>
            </div>

            <button class="primary-btn" onclick="saveSettings()">Save Configuration</button>
        </div>
    </div>

    <div class="app-container">
        
        <header>
            <div style="display:flex; gap:10px;">
                <button class="small-btn" onclick="openLocalModels()">My Models</button>
                <button class="small-btn" onclick="openLogHistory()">History</button>
            </div>
            
            <div style="flex-grow:1"></div>
            
            <button class="icon-btn" style="margin-right: 10px;" onclick="toggleSettings()" title="Settings">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </button>

            <div id="device-info" class="device-pill">Loading...</div>
            
            <button id="term-toggle" class="icon-btn" onclick="toggleTerminal()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="4 17 10 11 4 5"></polyline>
                    <line x1="12" y1="19" x2="20" y2="19"></line>
                </svg>
            </button>
        </header>

        <div id="page-search" class="page active">
            <div class="nav-header"><h3>Find Models</h3></div>
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search HF (e.g. Qwen, Llama)">
            </div>
            <div id="model-list" class="list-container">
                <div class="empty-state">Start typing to search Hugging Face...</div>
            </div>
        </div>

        <div id="page-my-models" class="page hidden">
            <div class="nav-header">
                <button class="back-btn" onclick="goToPage('page-search')">← Back</button>
                <h3>Downloaded Models</h3>
            </div>
            <div class="list-container" id="local-model-list"></div>
        </div>

        <div id="page-history" class="page hidden">
            <div class="nav-header">
                <button class="back-btn" onclick="goToPage('page-search')">← Back</button>
                <h3>Log History</h3>
            </div>
            <div id="history-list" class="list-container"></div>
        </div>

        <div id="page-files" class="page hidden">
            <div class="nav-header">
                <button class="back-btn" onclick="goToPage('page-search')">← Back</button>
                <h3>Select File</h3>
            </div>
            <div class="card">
                <span class="label">Repository</span>
                <div id="selected-repo-name" class="value-highlight">...</div>
            </div>
            <div id="file-list" class="list-container"></div>
        </div>

        <div id="page-run" class="page hidden">
            <div class="nav-header">
                <button id="run-back-btn" class="back-btn" onclick="goToPage('page-files')">← Add More</button>
                <h3>Run Configuration</h3>
            </div>

            <div class="card" style="margin-bottom: 16px; display:flex; flex-direction:column; gap:10px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span class="label">Selected Models (<span id="queue-count">0</span>)</span>
                    <button class="small-btn" style="color:var(--danger); background:rgba(255,46,46,0.1);" onclick="clearQueue()">Clear All</button>
                </div>
                
                <div id="queue-list-container" class="list-container" style="max-height: 180px; min-height: 60px; background:rgba(0,0,0,0.2); border-radius:8px; padding:10px;">
                    <div class="empty-state" style="margin-top:10px;">Queue is empty</div>
                </div>
            </div>

            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <span class="label">Benchmarks</span>
                    <button class="small-btn" onclick="openBenchmarkSelector()">Edit Tasks</button>
                </div>
                <div id="selected-tasks-preview" class="tags-preview" style="display:flex; flex-wrap:wrap; gap:6px;"></div>
            </div>
            
            <div class="action-area">
                <button id="start-btn" class="primary-btn">Start Benchmark Queue</button>
                <button id="stop-btn" class="stop-btn hidden">Stop Benchmark</button>
            </div>
        </div>

        <div id="page-benchmark-selector" class="page hidden">
            <div class="nav-header" style="justify-content:space-between;">
                <button class="back-btn" onclick="closeBenchmarkSelector()">Done</button>
                <h3>Select Tasks</h3>
                <button class="back-btn" style="color:var(--danger)" onclick="clearBenchmarks()">Reset</button>
            </div>
            <div class="search-bar">
                <input type="text" id="task-search" placeholder="Filter tasks...">
            </div>
            <div class="list-container" id="all-tasks-list"></div>
        </div>
    </div>

    <script src="js/globals.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/models.js"></script>
    <script src="js/history.js"></script>
    <script src="js/benchmark.js"></script>
    <script src="js/main.js"></script>
    <script src="js/settings.js"></script>
</body>
</html>